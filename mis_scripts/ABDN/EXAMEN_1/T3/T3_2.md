Aqu√≠ tienes la gu√≠a detallada para resolver la pr√°ctica **"UT3. Escalabilidad de BBDD Relacionales - Pr√°ctica 2: R√©plicas de lecturas en RDS"**.

Esta pr√°ctica tiene como objetivo entender c√≥mo funcionan las r√©plicas de lectura (Read Replicas) para escalar el rendimiento de lectura y proteger la base de datos principal.

---

# Gu√≠a Paso a Paso: R√©plicas de Lectura en Amazon RDS y Conexi√≥n desde Windows Server

### ‚ö†Ô∏è Consideraciones Previas (Costes)
El enunciado pide **4GB de RAM** para el Windows Server. Esto implica usar una instancia tipo **t2.medium** o **t3.medium**, las cuales **NO son gratuitas** (la capa gratuita solo cubre t2.micro/t3.micro con 1GB). Aseg√∫rate de apagar todo en cuanto termines la pr√°ctica para evitar cobros elevados.

---

### Fase 1: Crear la instancia EC2 (Cliente)

1.  Ve a la consola de **EC2** y pulsa **Lanzar instancia**.
2.  **Nombre:** `Cliente-Windows`.
3.  **Imagen (AMI):** Busca **Windows Server 2025 Base** (si no te aparece por ser muy nueva, selecciona **Windows Server 2022 Base**, servir√° igual).
4.  **Tipo de instancia:** Selecciona **t2.medium** o **t3.medium** (tienen 4GB RAM, requisito del PDF).
5.  **Par de claves:** Crea uno nuevo (formato `.pem`), desc√°rgalo y **no lo pierdas**. Lo necesitar√°s para la contrase√±a.
6.  **Configuraci√≥n de red (Security Group):**
    *   Crear un nuevo grupo de seguridad. Ll√°manos `SG-Windows`.
    *   Regla: Permitir tr√°fico **RDP** desde **Cualquier lugar (0.0.0.0/0)**.
7.  Lanza la instancia y espera a que est√© en estado "En ejecuci√≥n".

---

### Fase 2: Configurar la Seguridad de Red

Para cumplir el requisito de que *"tan solo se podr√° acceder desde la instancia EC2"*:

1.  Ve al apartado **Grupos de Seguridad** (Security Groups) en el men√∫ lateral de EC2.
2.  Crea uno nuevo llamado `SG-BaseDeDatos`.
3.  En **Reglas de entrada**, a√±ade una regla:
    *   **Tipo:** MySQL/Aurora (Puerto 3306).
    *   **Origen (Source):** Aqu√≠ **NO** pongas una IP. Selecciona "Custom" y empieza a escribir `SG-Windows` (el nombre del grupo que creaste en la Fase 1). Selecci√≥nalo cuando aparezca.
    *   *Esto asegura que solo las m√°quinas que pertenezcan al grupo de seguridad de Windows pueden entrar a la base de datos.*

---

### Fase 3: Crear la instancia RDS (Master)

1.  Ve a la consola de **RDS** -> **Crear base de datos**.
2.  **Creaci√≥n est√°ndar**.
3.  **Motor:** MySQL (o MariaDB).
4.  **Plantilla:** Desarrollo/Pruebas (o Capa gratuita si te deja elegir, pero recuerda que el EC2 ya te est√° costando dinero).
5.  **Identificador:** `rds-master`.
6.  **Credenciales:** Usuario `admin` y una contrase√±a que recuerdes.
7.  **Instancia:** `db.t3.micro` (para la BD es suficiente y m√°s barato).
8.  **Conectividad:**
    *   **Acceso p√∫blico:** **NO**.
    *   **Grupo de seguridad de VPC:** Selecciona **solo** el `SG-BaseDeDatos` que creamos en la Fase 2 (quita el default).
9.  **Crear base de datos**. Espera unos 5-10 minutos hasta que est√© "Disponible".

---

### Fase 4: Conexi√≥n y Preparaci√≥n del Entorno

1.  **Obtener contrase√±a de Windows:**
    *   En la consola EC2, selecciona tu instancia Windows -> Conectar -> Pesta√±a "Cliente RDP".
    *   Sube tu archivo `.pem` para descifrar la contrase√±a.
2.  **Conectarse:**
    *   Usa un cliente de Escritorio Remoto (RDP) en tu ordenador, pon la IP p√∫blica de la instancia, usuario `Administrator` y la contrase√±a descifrada.
3.  **Instalar software en el Windows Server:**
    *   Una vez dentro del Windows remoto, abre Edge.
    *   *Truco:* Es probable que la seguridad de IE/Edge no te deje descargar nada. Abre "Server Manager" -> "Local Server" -> "IE Enhanced Security Configuration" y ponlo en **Off**.
    *   Descarga e instala **DBeaver Community** o **MySQL Workbench**. (DBeaver suele ser m√°s ligero y f√°cil de instalar).

---

### Fase 5: Crear Datos en la Base de Datos Principal

1.  Abre DBeaver/Workbench en el servidor Windows.
2.  Crea una **Nueva Conexi√≥n MySQL**.
    *   **Host:** Copia el "Punto de enlace" (Endpoint) de tu instancia `rds-master` desde la consola de AWS.
    *   **Usuario/Pass:** Los que definiste al crear la RDS.
3.  Prueba la conexi√≥n (deber√≠a funcionar porque est√°s dentro del EC2 permitido).
4.  Abre una hoja SQL y ejecuta:

```sql
CREATE DATABASE prueba;
USE prueba;

CREATE TABLE alumno (
    id INT PRIMARY KEY,
    nombre VARCHAR(100)
);

INSERT INTO alumno (id, nombre) VALUES (1, 'Juan Perez');
INSERT INTO alumno (id, nombre) VALUES (2, 'Maria Lopez');
```
5.  Verifica con `SELECT * FROM alumno;`.

---

### Fase 6: Crear la R√©plica de Lectura

1.  Vuelve a tu consola de AWS (en tu navegador local, no en el remoto).
2.  Ve a **RDS**, selecciona tu instancia `rds-master`.
3.  Bot√≥n **Acciones** -> **Crear r√©plica de lectura** (Create read replica).
4.  **Identificador:** `rds-replica`.
5.  Deja el resto de opciones por defecto (usar√° el mismo Security Group, lo cual est√° bien).
6.  **Crear r√©plica**.
7.  Esto tardar√° unos minutos. Ver√°s que se crea una nueva instancia en la lista. Espera a que est√© **Disponible**.

---

### Fase 7: Comprobaci√≥n Final (El objetivo de la pr√°ctica)

1.  Vuelve al Escritorio Remoto (Windows Server).
2.  En DBeaver/Workbench, crea una **SEGUNDA conexi√≥n**.
    *   **Host:** Esta vez usa el Punto de enlace de la nueva **`rds-replica`**.
    *   **Usuario/Pass:** Los mismos de antes.
3.  **Prueba de Lectura (Debe funcionar):**
    Ejecuta:
    ```sql
    USE prueba;
    SELECT * FROM alumno;
    ```
    *Deber√≠as ver a Juan y Maria. Esto confirma que los datos se han replicado.*

4.  **Prueba de Escritura (Debe fallar):**
    Intenta insertar un dato en la r√©plica:
    ```sql
    INSERT INTO alumno (id, nombre) VALUES (3, 'Pedro Error');
    ```
    *Deber√≠as recibir un error tipo: `Error Code: 1290. The MySQL server is running with the --read-only option so it cannot execute this statement`.*

---

### üì∑ Capturas necesarias para verificar la pr√°ctica

Para demostrar que has completado todo correctamente, toma las siguientes capturas de pantalla:

1.  **Consola AWS EC2:** Mostrando la instancia Windows en ejecuci√≥n y sus detalles (donde se vea que es t2/t3.medium).
2.  **Consola AWS RDS:** Mostrando el listado de bases de datos donde se vea la estructura de **Principal (Master)** y debajo la **R√©plica**.
3.  **Escritorio Remoto (RDP):** Una captura general donde se vea que est√°s dentro de Windows Server y tienes el cliente SQL abierto.
4.  **Cliente SQL - Conexi√≥n Master:** Captura ejecutando el `SELECT` en la base de datos Principal mostrando los datos creados.
5.  **Cliente SQL - Conexi√≥n R√©plica (Lectura):** Captura ejecutando el mismo `SELECT` en la conexi√≥n de la r√©plica, demostrando que lee los datos.
6.  **Cliente SQL - Conexi√≥n R√©plica (Error de Escritura):** **(La m√°s importante)**. Captura del error (letras rojas) al intentar hacer el `INSERT` en la r√©plica, demostrando que es de solo lectura.
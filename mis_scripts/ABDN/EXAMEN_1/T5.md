춰Llegamos a la recta final! El **Tema 5 (T5)** trata sobre c칩mo cuidar, actualizar y tunear tu base de datos sin romper nada en el proceso.

En el examen, este tema suele centrarse en preguntas trampa tipo: *"He cambiado un par치metro y no surte efecto, 쯣or qu칠?"* (Spoiler: Falta reiniciar) o *"쮺칩mo actualizo sin dejar sin servicio a los usuarios?"*.

---

# 游닂 T5. Mantenimiento de Bases de Datos Relacionales (BDR)

## Ejercicio 1: Grupos de Par치metros (Parameter Groups)

**Teor칤a:** En una base de datos local (on-premise) t칰 editar칤as el archivo `my.cnf` (MySQL) o `postgresql.conf`. En RDS **no tienes acceso al sistema de archivos**.
Para cambiar configuraciones (como el n칰mero m치ximo de conexiones, timezones, logs), usas los **Parameter Groups**.

**丘멆잺 Regla de Oro del Examen:** El grupo de par치metros "Default" **NO SE PUEDE EDITAR**. Tienes que crear uno nuevo, editarlo y asignarlo.

### Pasos Detallados:

1.  **Crear el Grupo:**
    *   Ve al men칰 izquierdo de RDS -> **Parameter groups**.
    *   Clic en **Create parameter group**.
    *   **Parameter group family:** Aqu칤 debes ser preciso. Si tu base de datos es MySQL 8.0.35, debes elegir la familia `mysql8.0`. Si eliges otra, no te dejar치 asignarlo despu칠s.
    *   **Group name:** `pg-examen-custom`.
    *   **Description:** `Grupo personalizado para aumentar conexiones`.
    *   Clic en **Create**.

2.  **Editar los Par치metros:**
    *   Haz clic en el nombre de tu nuevo grupo (`pg-examen-custom`).
    *   Ver치s una lista con cientos de par치metros.
    *   Arriba a la derecha, clic en **Edit parameters**.
    *   **El reto:** Vamos a cambiar `max_connections`.
    *   En el buscador (Filter parameters) escribe: `max_connections`.
    *   Cambia el valor (que suele ser una f칩rmula matem치tica) por un n칰mero fijo, por ejemplo: `1000`.
    *   Baja y dale a **Save changes**.

3.  **Asignar el Grupo a la Base de Datos:**
    *   Ve a **Databases** -> Selecciona tu instancia -> **Modify**.
    *   Baja hasta la secci칩n **Additional configuration**.
    *   Busca **DB parameter group**.
    *   Cambia el `default.mysql8.0` por tu nuevo `pg-examen-custom`.
    *   **Continue**.
    *   Mira el resumen. Selecciona **Apply immediately**.
    *   **Modify DB Instance**.

4.  **El Paso Cr칤tico (La Trampa): Reiniciar**
    *   Si vas ahora a la pesta침a **Configuration** de tu base de datos, ver치s que el "Parameter group" dice `pg-examen-custom` pero al lado dir치 **(pending-reboot)** en rojo o naranja.
    *   *Explicaci칩n:* Los par치metros est치ticos (como `max_connections`) solo se aplican al arrancar el motor.
    *   Ve a **Actions** -> **Reboot**.
    *   Confirma el reinicio. Solo cuando la BD vuelva a estar *Available*, el cambio estar치 activo.

---

## Ejercicio 2: Ventana de Mantenimiento

**Teor칤a:** AWS saca parches de seguridad del Sistema Operativo o versiones menores de la BD. T칰 defines **cu치ndo** quieres que se apliquen para que no ocurra en horario laboral.

### Pasos Detallados:
1.  Selecciona tu instancia -> **Modify**.
2.  Busca la secci칩n **Maintenance**.
3.  **Maintenance window:**
    *   Cambia de "No preference" a **Select preference**.
4.  **Configuraci칩n:**
    *   **Start day:** Elige un d칤a de bajo tr치fico (ej. `Sunday`).
    *   **Start time:** Hora de menor uso (ej. `03:00` UTC).
    *   **Duration:** `1 hour`.
5.  **Apply immediately** -> **Modify DB Instance**.

**Nota para el examen:** Si marcas "Apply immediately" aqu칤, solo se actualiza la *configuraci칩n* de la ventana. Los parches reales esperar치n al domingo a las 3:00 AM, a menos que fuerces una actualizaci칩n de versi칩n manualmente.

---

## Ejercicio 3: Despliegue Blue/Green (Azul/Verde)

**Teor칤a:** Es la forma m치s segura de hacer actualizaciones mayores (ej. MySQL 5.7 a 8.0) o cambios de esquema peligrosos.
*   **Blue (Azul):** Tu entorno actual (Producci칩n).
*   **Green (Verde):** Un entorno nuevo, copia exacta del azul, donde aplicas los cambios.
*   Ambos se mantienen sincronizados (replicaci칩n). Cuando el verde est치 listo y probado, AWS cambia los sem치foros y el tr치fico pasa al verde en segundos.

### Pasos Detallados:
*Requisito:* Necesitas una base de datos compatible (MySQL o Aurora) con los backups autom치ticos activados.

1.  **Crear el Entorno Verde:**
    *   Selecciona tu base de datos actual.
    *   **Actions** -> **Create Blue/Green Deployment**.
    *   **Blue/Green deployment identifier:** `bg-actualizacion`.
2.  **Definir cambios para el Verde:**
    *   **Engine version:** Aqu칤 puedes decirle "Quiero que el entorno verde sea una versi칩n superior" (ej. de 8.0.32 a 8.0.35).
    *   **DB parameter group:** Podr칤as probar un grupo de par치metros nuevo aqu칤.
3.  **Crear:**
    *   Clic en **Create Blue/Green Deployment**.
    *   *Paciencia:* Esto tardar치 un rato. AWS est치 clonando tu instancia y configurando la replicaci칩n.

4.  **Simular el Cambio (Switchover):**
    *   Una vez que termine, ver치s un recurso nuevo agrupando Blue y Green.
    *   Supongamos que ya has hecho tus pruebas en la instancia Green (tiene su propio endpoint).
    *   Selecciona el despliegue Blue/Green.
    *   **Actions** -> **Switchover**.
    *   **Timeout setting:** AWS te preguntar치: "쯉i el cambio tarda m치s de X minutos, cancelo todo?". Pon 5 minutos.
    *   Clic en **Switchover**.

**Resultado:**
*   AWS bloquea las escrituras en el Blue.
*   Espera a que el Green atrape los 칰ltimos datos.
*   Cambia los DNS. Ahora tu Endpoint principal apunta a la m치quina Green.
*   La m치quina Blue queda "vieja" y desconectada para que la borres luego.

---

## 游닇 Resumen Final para tu Examen

He recopilado los puntos clave de los 5 temas para que los memorices antes de entrar:

1.  **Seguridad:** Si no conectas, mira el **Security Group**. La regla debe permitir puerto 3306 desde tu IP (p칰blica) o desde el SG de la EC2 (privada).
2.  **Escalado:**
    *   쮽alta CPU/RAM? -> **Escalado Vertical** (Instance Type).
    *   쯄ucha gente leyendo? -> **Escalado Horizontal** (Read Replica).
3.  **Alta Disponibilidad (DR):**
    *   쯉e cae la zona? -> **Multi-AZ** (Failover autom치tico).
    *   쮹orraste datos? -> **Backup / Snapshot** (Restauraci칩n lenta).
4.  **Aurora:**
    *   Escala solo -> **Serverless v2**.
    *   Endpoint 칰nico de lectura -> **Reader Endpoint**.
5.  **Mantenimiento:**
    *   쮺ambiar configuraci칩n `my.cnf`? -> **Parameter Group** (y requiere **Reboot**).
    *   쮸ctualizar versi칩n sin miedo? -> **Blue/Green Deployment**.

---

### 游빛 Limpieza Final del Curso (Checklist)

Para asegurar que AWS no te cobre ni un c칠ntimo m치s a partir de hoy, verifica haber borrado:
1.  [ ] **Despliegues Blue/Green** (Borra el recurso y las instancias asociadas).
2.  [ ] **Read Replicas** y **Instancias RDS** principales.
3.  [ ] **Snapshots Manuales** (Men칰 Snapshots).
4.  [ ] **Clusters de ElastiCache**.
5.  [ ] **Proxies de RDS**.
6.  [ ] **Secretos** en Secrets Manager.
7.  [ ] **Instancias EC2** y entornos **Cloud9**.
8.  [ ] **Direcciones IP El치sticas (Elastic IPs)** si creaste alguna y no la usas.

춰Has completado el temario completo! Tienes el conocimiento te칩rico y la pr치ctica paso a paso. 춰Mucha suerte en tu examen! 游
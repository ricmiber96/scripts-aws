Perfecto, avanzamos al **Tema 2 (T2)**. Este bloque es fundamental porque ya no estamos "jugando" con una base de datos aislada, sino **arquitecturando** soluciones reales.

En este tema abordamos tres escenarios clave de examen:
1.  **Seguridad Real:** Conexi√≥n privada EC2 -> RDS (arquitectura cl√°sica).
2.  **Backup y Rendimiento:** Snapshots y Cach√©.
3.  **Motores Modernos:** Amazon Aurora y sus modos de despliegue.

---

# üìò T2. Despliegue de RDS Avanzado

## Ejercicio 1: Crear RDS con acceso desde EC2 (Privado)

**El Escenario:** En la vida real, una base de datos **NUNCA** debe tener acceso p√∫blico (como hicimos en el T1). La base de datos debe estar escondida y solo debe aceptar conexiones de tu servidor web (EC2).

**Pasos para resolverlo:**

### Paso A: Crear los Grupos de Seguridad (Los "Porteros")
Antes de crear las m√°quinas, vamos a crear las reglas de juego. Necesitamos dos grupos.

1.  Ve a la consola de **EC2** -> Men√∫ izquierdo **Security Groups** -> **Create security group**.
    *   **Nombre:** `sg-servidor-web`
    *   **Description:** Permitir SSH.
    *   **Inbound Rules (Reglas de entrada):**
        *   Type: **SSH** (22) | Source: **My IP**.
    *   Clic en **Create security group**.

2.  Crea el segundo grupo (**Create security group** de nuevo).
    *   **Nombre:** `sg-base-datos-privada`
    *   **Description:** Permitir trafico solo desde el servidor web.
    *   **Inbound Rules:**
        *   Type: **MySQL/Aurora** (3306).
        *   Source (Aqu√≠ est√° la magia): **No pongas una IP**. Haz clic en la caja de b√∫squeda y selecciona el grupo que creaste antes: `sg-servidor-web`.
        *   *Explicaci√≥n:* Esto dice "Solo dejo entrar a quien tenga la tarjeta de identificaci√≥n del servidor web".
    *   Clic en **Create security group**.

### Paso B: Lanzar la instancia EC2 (El Cliente)
1.  Ve a **EC2** -> **Launch Instances**.
2.  **Name:** `Mi-Servidor-Web`.
3.  **OS:** Amazon Linux 2023.
4.  **Instance Type:** t2.micro o t3.micro (Free Tier).
5.  **Key pair:** Selecciona una que tengas (o crea una nueva `.pem` para conectarte).
6.  **Network settings:**
    *   En **Firewall (security groups)**, selecciona **Select existing security group**.
    *   Elige: `sg-servidor-web`.
7.  **Launch instance**.

### Paso C: Crear la RDS Privada
1.  Ve a **RDS** -> **Create database**.
2.  **Engine:** MySQL.
3.  **Template:** Free Tier.
4.  **Settings:** Identificador `rds-privada`, user `admin`, pass `Admin12345`.
5.  **Connectivity:**
    *   **Compute resource:** Don‚Äôt connect to an EC2 compute resource (Lo haremos manualmente con los SGs).
    *   **Public access:** üî¥ **NO**. (Esto es vital. Sin IP p√∫blica).
    *   **VPC Security Group:** Choose existing -> Quita el `default` y selecciona `sg-base-datos-privada`.
6.  **Create database**.

### Paso D: Conectar y Verificar
Ahora la RDS no tiene IP p√∫blica, as√≠ que tu Workbench de casa **no funcionar√°**. Tienes que entrar a trav√©s de la EC2.

1.  Con√©ctate por SSH a tu EC2:
    ```bash
    ssh -i tu-clave.pem ec2-user@DIRECCION_IP_PUBLICA_EC2
    ```
2.  Una vez dentro de la EC2, instala un cliente MySQL (MariaDB client):
    ```bash
    sudo dnf install mariadb105 -y
    ```
3.  Intenta conectar a la RDS usando su Endpoint (b√∫scalo en la consola de RDS cuando est√© 'Available'):
    ```bash
    mysql -h rds-privada.xxxxx.us-east-1.rds.amazonaws.com -u admin -p
    ```
4.  Si te pide contrase√±a y entras (`mysql>`), **¬°Ejercicio resuelto!** Has demostrado que la conexi√≥n funciona internamente gracias a los Security Groups.

---

## Ejercicio 2: Crear RDS, Snapshot y Cach√© (Comparar)

Este ejercicio suele tener preguntas te√≥ricas asociadas sobre velocidad.

### A. Hacer un Snapshot (Copia de seguridad est√°tica)
*Objetivo:* Guardar el estado exacto de la base de datos para poder "viajar en el tiempo" luego.

1.  Ve a tu consola **RDS** -> **Databases**.
2.  Selecciona la base de datos `rds-privada` (o cualquiera que tengas activa).
3.  Arriba a la derecha, bot√≥n **Actions** -> **Take snapshot**.
4.  **Snapshot name:** `foto-antes-del-desastre`.
5.  Clic en **Take snapshot**.
6.  Ve al men√∫ izquierdo -> **Snapshots**. Ver√°s que se est√° creando.
    *   *Nota:* Para restaurarlo, solo tendr√≠as que seleccionarlo y dar a *Actions -> Restore Snapshot*. Eso crear√≠a una **nueva** base de datos id√©ntica a la original.

### B. Crear ElastiCache (Redis)
*Objetivo:* Entender que esto es una memoria RAM externa para acelerar la web.

1.  En el buscador de servicios, escribe **ElastiCache**.
2.  Men√∫ izq -> **Redis clusters**.
3.  **Create Redis cluster**.
4.  **Cluster settings:**
    *   Selecciona: **Design your own cluster** (Para tener control).
    *   **Cluster mode:** Disabled (Para este ejercicio b√°sico basta con uno simple).
    *   **Name:** `mi-cache-examen`.
5.  **Location:** AWS Cloud.
6.  **Cluster settings (Nodo):**
    *   **Node type:** Cambia a `cache.t2.micro` o `cache.t3.micro` (Busca los que dicen Free Tier eligible si tienes cuenta nueva, si no, son muy baratos por hora).
    *   **Number of replicas:** 0 (Para ahorrar).
7.  **Subnet group:** Create new -> Dale un nombre y selecciona tu VPC.
8.  Baja al final y **Create**.

### C. Comparaci√≥n (Para explicar en el examen)
Si te piden comparar ambas tecnolog√≠as:
*   **RDS:** Guarda en **Disco (EBS)**. Persistencia segura. Velocidad: Milisegundos (ms). Es la "verdad" de los datos.
*   **ElastiCache:** Guarda en **Memoria RAM**. Vol√°til (se puede perder si se apaga). Velocidad: Microsegundos (¬µs). Se usa para guardar cosas que se piden mucho (ej: Top 10 ventas del d√≠a) para no molestar a la RDS.

---

## Ejercicio 3: Crear RDS con Aurora

Aurora es el "Ferrari" de las bases de datos de AWS. Es compatible con MySQL/Postgres pero mucho m√°s r√°pido y resiliente.

### Escenario A: Aurora Aprovisionado (Provisioned)
*Es como contratar un servidor fijo.*

1.  **RDS** -> **Create database**.
2.  **Engine:** **Aurora (MySQL Compatible)**.
3.  **Templates:** Dev/Test (Aurora no tiene Free Tier gratuito de por vida, cuidado con dejarlo encendido).
4.  **Instance configuration:**
    *   Aqu√≠ seleccionas **DB Instance Class**.
    *   Elige **Burstable classes** -> `db.t3.medium` (es la m√°s barata para pruebas).
5.  F√≠jate que en Aurora, por defecto, te crea un **Cl√∫ster** (un grupo) que contiene una instancia **Writer** (Escritura).
6.  *Configuraci√≥n restante:* Igual que una RDS normal (user, pass, VPC).

### Escenario B: Aurora Serverless v2 (Sin Servidor)
*Es como la luz de casa: pagas por lo que consumes minuto a minuto.*

1.  **RDS** -> **Create database**.
2.  **Engine:** **Aurora (MySQL Compatible)**.
3.  **Instance configuration:**
    *   Selecciona la opci√≥n **Serverless v2**.
4.  **Capacity settings (Lo importante del examen):**
    *   Ver√°s un rango de **ACUs** (Aurora Capacity Units).
    *   **Minimum:** 0.5 ACU (aprox 1GB RAM).
    *   **Maximum:** 1 ACU (para la prueba, en real podr√≠as poner 128).
    *   *Explicaci√≥n:* AWS vigila la CPU y RAM. Si entra mucha gente, sube las ACUs autom√°ticamente hasta el m√°ximo. Si no hay nadie, baja al m√≠nimo.
5.  Termina de crearla.

---

### ‚ö†Ô∏è Notas Importantes de Limpieza (T2)
Este tema es "peligroso" para tu bolsillo si te descuidas. En cuanto termines de practicar:
1.  **Borra las RDS Aurora:** Son m√°s caras que las normales.
2.  **Borra el Cluster de ElastiCache:** Se cobra por hora de nodo encendido.
3.  **Borra los Snapshots:** AWS cobra por el espacio de almacenamiento de los snapshots manuales.
4.  **Det√©n/Borra la EC2** si no la vas a usar m√°s.

¬øListo el T2? Si has entendido bien la diferencia entre acceso P√∫blico vs Privado (SGs) y Aurora Serverless, est√°s muy bien preparado. ¬øPasamos al **T3 (Escalado)**?